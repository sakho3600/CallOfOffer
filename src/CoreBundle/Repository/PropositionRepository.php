<?php

namespace CoreBundle\Repository;

/**
 * PropositionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PropositionRepository extends \Doctrine\ORM\EntityRepository
{

    public function getByCooAndUser($idCoo, $idProvider)
    {
        return $this->getEntityManager()
            ->createQuery('SELECT p FROM  CoreBundle:Proposition p WHERE p.provider = :idProvider and p.callOfOffer = :idCoo')
            ->setParameter('idProvider', $idProvider)
            ->setParameter('idCoo', $idCoo)
            ->getSingleResult();
    }

    public function getCooByPropositionId($idProp){
        return $this->getEntityManager()
            ->createQuery('SELECT c FROM  CoreBundle:Proposition p, CoreBundle:CallOfOffer c WHERE p.id = :idProp and c.id = p.callOfOffer')
            ->setParameter('idProp', $idProp)
            ->getSingleResult();
    }

    public function getCooTagByPropositionId($idProp){
        return $this->getEntityManager()
            ->createQuery('SELECT c.tag FROM  CoreBundle:Proposition p, CoreBundle:CallOfOffer c WHERE p.id = :idProp and c.id = p.callOfOffer')
            ->setParameter('idProp', $idProp)
            ->getSingleResult();
    }

    public function getCooProviderUsernameByPropositionId($idProp){
        return $this->getEntityManager()
            ->createQuery('SELECT pr.username FROM  CoreBundle:Proposition p, CoreBundle:Provider pr WHERE p.id = :idProp and pr.id = p.provider')
            ->setParameter('idProp', $idProp)
            ->getSingleResult();
    }
}
